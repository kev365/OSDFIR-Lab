graph TD
    subgraph Initialization
        A[Start: GH Action build] --> B[Build & Push to GHCR];
    end

    subgraph "Local (legacy manual build)"
        B -. optional .-> C[build-timesketch-mcp.ps1];
        C --> D[Build Image locally];
        D --> E[Push/Load Image];
    end

    subgraph "Minikube Build (legacy)"
        C -- minikube flag --> F{Minikube Running?};
        F -- No --> G[Start Minikube];
        F -- Yes --> H[Switch to Minikube Docker Context];
        G --> H;
        H --> I[Confirm Build];
        I --> J[Build Image in Minikube];
        J --> K{Deployment Exists?};
        K -- Yes --> L[Update & Restart Deployment];
        K -- No --> M[Restore Docker Context];
        L --> M;
        M --> N{Minikube Started by Script?};
        N -- Yes --> O[Stop Minikube];
        N -- No --> P[End: Build Complete];
        O --> P;
    end

    style A fill:#2ecc71,stroke:#333,stroke-width:2px
    style E fill:#3498db,stroke:#333,stroke-width:2px
    style P fill:#3498db,stroke:#333,stroke-width:2px
